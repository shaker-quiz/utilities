import { ParameterPattern, PathnameParameters, Route, RoutePathname } from '../codegen/autogenerated.js'
import { access } from './access.js'

/**
 * @template {keyof typeof import('@shakerquiz/utilities').Route} R
 *
 * @param {R} maybeRoute
 * @param {any[]} maybeParams
 *
 * @returns {typeof import('@shakerquiz/utilities').RoutePathname[R]}
 */
export const hydrateRoutePathname = (maybeRoute, maybeParams) => {
  if (!Array.isArray(maybeParams))
    throw TypeError(`Parameter 'params' must be 'Array'.`)

  var route = access(Route, maybeRoute)

  var pathname = access(RoutePathname, route)

  var pathnameParameters = access(PathnameParameters, pathname)

  return pathnameParameters.reduce((pathname, parameter, index) =>
    Object.hasOwn(maybeParams, index)
      ? pathname.replace(parameter, maybeParams[index])
      : pathname, pathname)
}

/**
 * @template {keyof typeof import('@shakerquiz/utilities').Route} R
 *
 * @param {R} maybeRoute
 * @param {any[]} maybeParams
 *
 * @returns {typeof import('@shakerquiz/utilities').RoutePathname[R]}
 */
export const parametrizeRoutePathname = (maybeRoute, maybeParams) => {
  if (!Array.isArray(maybeParams))
    throw TypeError(`Parameter 'params' must be 'Array'.`)

  var route = access(Route, maybeRoute)

  var pathname = access(RoutePathname, route)

  var pathnameParameters = access(PathnameParameters, pathname)

  return pathnameParameters.reduce((pathname, parameter, index) =>
    Object.hasOwn(maybeParams, index)
      ? pathname.replace(parameter, maybeParams[index])
      : pathname.replace(parameter, access(ParameterPattern, parameter)), pathname)
}
